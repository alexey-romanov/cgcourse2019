<!DOCTYPE html>
<html lang="en">

<head>

    <title>3D object rendering</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta charset="UTF-8" />

    <link href="styles/main.css" rel="stylesheet" type="text/css">

    <script id="phongLightingVertexShader" type="x-shader/x-vertex">
        varying vec3 Normal;
        varying vec3 Position;
        varying vec2 vUv;

        void main() {
            Normal = normalize(normalMatrix * normal);
            Position = vec3(modelViewMatrix * vec4(position, 1.0));
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>

    <script id="phongLightingFragmentShader" type="x-shader/x-fragment">
        varying vec3 Normal;
        varying vec3 Position;
        varying vec2 vUv;

        uniform float time;
        uniform float dissolve;

        uniform vec3 Ka;
        uniform vec3 Kd;
        uniform vec3 Ks;
        uniform vec4 LightPosition;
        uniform vec3 LightIntensity;
        uniform float Shininess;

        uniform sampler2D u_texture;
        uniform sampler2D burn_texture;

        vec3 phong() {
            vec3 n = normalize(Normal);
            vec3 s = normalize(vec3(LightPosition) - Position);
            vec3 v = normalize(vec3(-Position));
            vec3 r = reflect(-s, n);

            vec3 ambient = Ka;
            vec3 diffuse = Kd * max(dot(s, n), 0.0);
            vec3 specular = Ks * pow(max(dot(r, v), 0.0), Shininess);

            return LightIntensity * (ambient + diffuse + specular);
        }

        float modI(float a,float b) {
            float m=a-floor((a+0.5)/b)*b;
            return floor(m+0.5);
        }

        void main() {
            vec4 noise_tex = texture2D(u_texture, vec2(Position.x / 100.0, Position.y / 100.0));

            float d = (2.0 * dissolve + noise_tex.x) - 1.0;
            float over_one = saturate(d * 1.5);
            vec4 burn_tex = texture2D(burn_texture, vec2(over_one, 0.5));

            vec4 color = vec4(phong(), 1.0);
            
            color *= burn_tex;
            gl_FragColor = color;
        }
    </script>

    <script src="https://threejs.org/build/three.min.js"></script>
    <script src="https://threejs.org/examples/js/libs/inflate.min.js"></script>
    <script src="https://threejs.org/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://threejs.org/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

</head>

<body>

    <div id="scene-container">
    </div>

    <script src="js/app.js"></script>

</body>

</html>
